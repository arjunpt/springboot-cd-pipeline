#pipeline {
#  agent { label 'demo' }
# parameters {
#    string(name: 'IMAGETAG', defaultValue: '1', description: 'Please Enter the Image Tag to Deploy?')
#    choice(name:'environment', choices: ['functional', 'integration', 'regression', 'uat', 'release'], description: 'Select where to deploy')
#  }
#  stages {
#    stage('Deploy') {
#      steps {
#        git branch: 'main', url: 'https://github.com/arjunpt/springboot-cd-pipeline.git'
#        dir("./${params.environment}") {
#          sh "sed -i 's/image: adamtravis.*/image: adamtravis\\/democicd:$IMAGETAG/g' deployment.yml"
#        }
#        // Only include push if you're pushing back updated YAML to GitHub
#        // Requires GitHub PAT and credentialsId
#      }
#    }
#  }
#}

pipeline {
  agent { label 'demo' }
  parameters {
    string(name: 'IMAGETAG', defaultValue: '1', description: 'Please Enter the Image Tag to Deploy?')
    choice(name:'environment', choices: ['functional', 'integration', 'regression', 'uat', 'release'], description: 'Select where to deploy')
  }
  stages {
    stage('Deploy') {
      steps {
        git branch: 'main', url: 'https://github.com/arjunpt/springboot-cd-pipeline.git'
        dir("./${params.environment}") {
          sh "sed -i 's/image: arjunpt.*/image: arjunpt\\/democicd:$IMAGETAG/g' deployment.yml"
        }
        // Only include push if you're pushing back updated YAML to GitHub
        // Requires GitHub PAT and credentialsId
      }
    }
  }
}

